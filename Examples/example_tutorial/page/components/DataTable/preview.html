<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataTable Component Preview</title>

    <!-- Tabulator CSS -->
    <link href="https://unpkg.com/tabulator-tables@6.3.1/dist/css/tabulator.min.css" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f1f5f9;
            padding: 2rem;
        }

        /* Container: Figma 선택 요소 크기 */
        #component-container {
            width: 100%;
            max-width: 900px;
            height: 400px;
            margin: 0 auto;
        }
    </style>
    <link rel="stylesheet" href="styles/component.css">
</head>
<body>
    <!-- Component Container -->
    <div id="component-container">
        <div class="data-table">
            <!-- Header -->
            <div class="panel-header">
                <div class="panel-title-group">
                    <h3 class="panel-title">Sales Data</h3>
                    <p class="panel-subtitle">Recent sales records</p>
                </div>
                <div class="panel-actions">
                    <select class="filter-select">
                        <option value="all">All Categories</option>
                        <option value="electronics">Electronics</option>
                        <option value="clothing">Clothing</option>
                        <option value="food">Food</option>
                    </select>
                </div>
            </div>

            <!-- Table Meta -->
            <div class="table-meta"></div>

            <!-- Tabulator Container -->
            <div class="table-container"></div>
        </div>
    </div>

    <!-- Mock Data -->
    <script>
        const MOCK_DATA = {
            tableData: {
                success: true,
                data: [
                    { id: 1, product: 'Laptop Pro 15', category: 'electronics', quantity: 5, price: 1299, total: 6495, date: '2024-01-15' },
                    { id: 2, product: 'Wireless Mouse', category: 'electronics', quantity: 25, price: 49, total: 1225, date: '2024-01-15' },
                    { id: 3, product: 'Winter Jacket', category: 'clothing', quantity: 12, price: 189, total: 2268, date: '2024-01-14' },
                    { id: 4, product: 'Running Shoes', category: 'clothing', quantity: 8, price: 129, total: 1032, date: '2024-01-14' },
                    { id: 5, product: 'Organic Coffee', category: 'food', quantity: 50, price: 24, total: 1200, date: '2024-01-13' },
                    { id: 6, product: 'Green Tea Set', category: 'food', quantity: 30, price: 35, total: 1050, date: '2024-01-13' }
                ],
                meta: {
                    total: 6,
                    category: 'all'
                }
            }
        };
    </script>

    <!-- Tabulator JS -->
    <script src="https://unpkg.com/tabulator-tables@6.3.1/dist/js/tabulator.min.js"></script>

    <!-- Render Functions (from scripts/register.js) -->
    <script>
        const container = document.getElementById('component-container');

        // Table Config 패턴
        const tableConfig = {
            columns: [
                { title: 'ID', field: 'id', width: 60, hozAlign: 'center' },
                { title: 'Product', field: 'product', widthGrow: 2 },
                { title: 'Category', field: 'category', width: 120 },
                { title: 'Qty', field: 'quantity', width: 80, hozAlign: 'right' },
                { title: 'Price', field: 'price', width: 100, hozAlign: 'right',
                  formatter: cell => `$${cell.getValue().toLocaleString()}` },
                { title: 'Total', field: 'total', width: 120, hozAlign: 'right',
                  formatter: cell => `$${cell.getValue().toLocaleString()}` },
                { title: 'Date', field: 'date', width: 110, hozAlign: 'center' }
            ]
        };

        // Tabulator 인스턴스 생성
        const tableContainer = container.querySelector('.table-container');
        const uniqueId = `table-${Date.now()}`;
        tableContainer.id = uniqueId;

        const tableInstance = new Tabulator(`#${uniqueId}`, {
            layout: 'fitColumns',
            height: '100%',
            placeholder: 'No data available',
            columns: tableConfig.columns
        });

        // 행 클릭 이벤트
        tableInstance.on('rowClick', (e, row) => {
            console.log('[Page] Table row clicked:', row.getData());
        });

        function renderTable(response) {
            const { data, meta } = response;
            if (!data) return;

            tableInstance.setData(data);

            const metaEl = container.querySelector('.table-meta');
            if (metaEl && meta) {
                metaEl.textContent = `Total: ${meta.total} items (${meta.category})`;
            }

            console.log('[DataTable] Table rendered:', data.length, 'rows');
        }

        // 필터 이벤트
        container.querySelector('.filter-select').addEventListener('change', (e) => {
            console.log('[Page] Filter changed:', e.target.value);
        });

        // Tabulator가 완전히 빌드된 후 데이터 로드
        tableInstance.on('tableBuilt', () => {
            renderTable(MOCK_DATA.tableData);
        });
    </script>
</body>
</html>
