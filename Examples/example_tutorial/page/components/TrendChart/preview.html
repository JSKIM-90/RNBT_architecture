<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrendChart Component Preview</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f1f5f9;
            padding: 2rem;
        }

        /* Container: Figma 선택 요소 크기 */
        #component-container {
            width: 100%;
            max-width: 900px;
            height: 400px;
            margin: 0 auto;
        }
    </style>
    <link rel="stylesheet" href="styles/component.css">
</head>
<body>
    <!-- Component Container -->
    <div id="component-container">
        <div class="trend-chart">
            <!-- Header -->
            <div class="panel-header">
                <div class="panel-title-group">
                    <h3 class="panel-title">Trend Analysis</h3>
                    <p class="panel-subtitle">Revenue and orders over time</p>
                </div>
                <div class="panel-actions">
                    <select class="period-select">
                        <option value="24h">Last 24 Hours</option>
                        <option value="7d" selected>Last 7 Days</option>
                        <option value="30d">Last 30 Days</option>
                    </select>
                </div>
            </div>

            <!-- Chart Container -->
            <div class="chart-container"></div>
        </div>
    </div>

    <!-- Mock Data -->
    <script>
        const MOCK_DATA = {
            chartData: {
                success: true,
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    series: [
                        { name: 'Revenue', data: [4500, 5200, 4800, 6100, 5500, 4900, 5800], color: '#3b82f6' },
                        { name: 'Orders', data: [120, 145, 130, 165, 150, 135, 160], color: '#10b981' }
                    ]
                },
                meta: { period: '7d' }
            }
        };
    </script>

    <!-- ECharts JS -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>

    <!-- Render Functions (from scripts/register.js) -->
    <script>
        const container = document.getElementById('component-container');

        // Chart Config 패턴
        const chartConfig = {
            xKey: 'labels',
            seriesKey: 'series'
        };

        // ECharts 인스턴스 생성
        const chartContainer = container.querySelector('.chart-container');
        const chartInstance = echarts.init(chartContainer);

        // ResizeObserver
        const resizeObserver = new ResizeObserver(() => {
            chartInstance && chartInstance.resize();
        });
        resizeObserver.observe(chartContainer);

        // Option Builder
        function getChartOptions(config, data) {
            const { xKey, seriesKey } = config;
            const labels = data[xKey];
            const seriesData = data[seriesKey];

            return {
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { type: 'cross' }
                },
                legend: {
                    data: seriesData.map(s => s.name),
                    top: 0,
                    textStyle: { fontSize: 12 }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    top: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: labels,
                    axisLabel: { fontSize: 11 },
                    boundaryGap: false
                },
                yAxis: {
                    type: 'value',
                    axisLabel: { fontSize: 11 },
                    splitLine: {
                        lineStyle: { type: 'dashed', color: '#e2e8f0' }
                    }
                },
                series: seriesData.map(s => ({
                    name: s.name,
                    type: 'line',
                    smooth: true,
                    symbol: 'circle',
                    symbolSize: 6,
                    data: s.data,
                    lineStyle: { color: s.color, width: 2 },
                    itemStyle: { color: s.color },
                    areaStyle: {
                        color: {
                            type: 'linear',
                            x: 0, y: 0, x2: 0, y2: 1,
                            colorStops: [
                                { offset: 0, color: s.color + '40' },
                                { offset: 1, color: s.color + '05' }
                            ]
                        }
                    }
                }))
            };
        }

        function renderChart(response) {
            const { data, meta } = response;
            if (!data) return;

            const option = getChartOptions(chartConfig, data);

            try {
                chartInstance.setOption(option, true);
                console.log('[TrendChart] Chart rendered:', meta?.period || 'default');
            } catch (error) {
                console.error('[TrendChart] setOption error:', error);
            }
        }

        // 기간 변경 이벤트
        container.querySelector('.period-select').addEventListener('change', (e) => {
            console.log('[Page] Period changed:', e.target.value);
        });

        // Execute rendering
        renderChart(MOCK_DATA.chartData);
    </script>
</body>
</html>
